(self.webpackChunk_minimal_minimal_kit_react=self.webpackChunk_minimal_minimal_kit_react||[]).push([[7745],{36880:(e,t,s)=>{"use strict";s.d(t,{A:()=>p});var a=s(53536),n=s(5748),r=s(11892),i=s(96446),l=s(85865),o=s(77739),c=s(17392),d=s(88446),u=s(76412),h=s(70579);function p(e){let{links:t,action:s,heading:p,info:x,moreLink:m=[],sx:S,...g}=e;return(0,h.jsxs)(i.A,{sx:{mb:5,...S},children:[(0,h.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[(0,h.jsxs)(i.A,{sx:{flexGrow:1},children:[(0,h.jsxs)(i.A,{sx:{display:"flex",alignItems:"flex-start"},children:[(0,h.jsx)(l.A,{variant:"h4",gutterBottom:!0,children:p}),(0,h.jsx)(o.A,{title:x,placement:"bottom",arrow:!0,children:(0,h.jsx)(c.A,{children:(0,h.jsx)(n.In,{icon:r.A,width:25,height:25})})})]}),(0,h.jsx)(u._5,{links:t,...g})]}),s&&(0,h.jsx)(i.A,{sx:{flexShrink:0},children:s})]}),(0,h.jsx)(i.A,{sx:{mt:2},children:(0,a.isString)(m)?(0,h.jsx)(d.A,{href:m,target:"_blank",variant:"body2",children:m}):m.map(e=>(0,h.jsx)(d.A,{noWrap:!0,href:e,variant:"body2",target:"_blank",sx:{display:"table"},children:e},e))})]})}},50477:()=>{},57390:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});s(65043);var a=s(96446),n=s(81637),r=s(70579);function i(e){let{loading:t}=e;return t?(0,r.jsx)(a.A,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",bgcolor:"rgba(255, 255, 255, 0.6)",zIndex:e=>e.zIndex.modal+1,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsx)(n.A,{size:48})}):null}},99965:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>O});var a=s(65043),n=s(86897),r=s(46987),i=s(73216),l=s(86178),o=s.n(l),c=s(19252),d=s(68903),u=s(12110),h=s(88911),p=s(85865),x=s(23609),m=s(43845),S=s(67784),g=s(74605),A=s(19042),f=s(42518),C=s(83462),b=s(26600),j=s(35316),y=s(29347),v=s(86213),k=s(26502),w=s(54211),E=s.n(w),R=s(86947),D=s.n(R),T=s(80916),N=s(57390),M=s(15285),I=s(95683),L=s(88930),P=s(5963),_=s(36880),z=s(48407),B=s(11737);const F=(e,t)=>{let s;return Object.keys(e).some(a=>a===t?(s=e[a],!0):e[a]&&"object"===typeof e[a]?(s=F(e[a],t),void 0!==s):s),s};var $=s(70579);function O(){let e=[];const t=[],s=(0,a.useRef)([]),l=(0,a.useRef)([]),[w,R]=(0,a.useState)([]),[O,Y]=(0,a.useState)(null),[V,q]=(0,a.useState)(!1),[U,W]=(0,a.useState)(!0),[J,G]=(0,a.useState)(!0),[H,K]=(0,a.useState)(!1),{enqueueSnackbar:Q}=(0,r.dh)(),[Z,X]=(0,a.useState)("No releases found"),[ee,te]=(0,a.useState)("");E().addVirtualFileSystem(D());const{appendUrl:se}=(0,M.d4)(e=>e.user),{themeStretch:ae}=(0,B.A)(),ne=(0,i.Zp)();(0,a.useEffect)(()=>{ce()},[]),(0,a.useEffect)(()=>{q(!U)},[U]);const re=(0,n.Wx)({enableReinitialize:!0,initialValues:{releaseList:[],testRun:!0,testCases:!1,testCaseSteps:!1,testCaseStepStatus:!1},validateOnChange:!0,onSubmit:async(e,t)=>{let{setSubmitting:s,resetForm:a,setErrors:n}=t;try{s(!1)}catch(r){s(!1),n(r)}}}),{values:ie,handleSubmit:le,setFieldValue:oe}=re;(0,a.useEffect)(()=>{0===ie.releaseList.length&&(oe("testCases",!1),oe("testCaseSteps",!1),oe("testCaseStepStatus",!1))},[ie.releaseList]),(0,a.useEffect)(()=>{me(!0)},[ie.testCases,ie.testCaseSteps,ie.testCaseStepStatus]);const ce=async()=>{const a=await(0,I.Kv)();try{var n;const d=await(0,v.A)({method:"get",url:`${L.A.releases.getReleaseByPID2(null===a||void 0===a?void 0:a._id)}`,headers:{Authorization:`Bearer ${(0,P.qt)("accessToken")}`}});var r,i,l,o;if(200===(null===d||void 0===d?void 0:d.status)&&Array.isArray(null===(n=d.data)||void 0===n?void 0:n.response))if((null===(r=d.data)||void 0===r||null===(i=r.response)||void 0===i?void 0:i.length)>0){if(null===(l=d.data)||void 0===l||null===(o=l.response)||void 0===o||o.forEach(t=>{t.testRunVersion&&e.push(t._id)}),0!==e.length){var c;const a=await(0,v.A)({method:"get",url:`${L.A.releases.getExecutingReleasesData(e)}`,headers:{Authorization:`Bearer ${(0,P.qt)("accessToken")}`}});s.current=null===a||void 0===a||null===(c=a.data)||void 0===c?void 0:c.data,e=[],null===s||void 0===s||s.current.forEach(s=>{"completed"===s.runningStatus.toLowerCase()&&(e.push(s._id),t.push(s.releaseName))}),0!==t.length&&R(t)}}else W(!1),X("No releases found");else X("Failed to Load")}catch(d){X("Failed to Load"),console.log(d)}finally{G(!1)}},de=e=>{const t={};return e.forEach(e=>{let{data:s}=e;const{releaseName:a,modules:n}=s,r=Array.isArray(n)&&n[1];r&&Array.isArray(r.testNodes)&&(t[a]||(t[a]=[]),t[a].push(...r.testNodes))}),Object.entries(t).map(e=>{let[t,s]=e;return{releaseName:t,testNodes:s}})},ue=async e=>{K(!0),Y(e);const t={testCases:ie.testCases,testCaseSteps:ie.testCaseSteps,testCaseStepStatus:ie.testCaseStepStatus},s=await(0,I.uV)();let a,n;try{"pdf"===e?(n=await new Promise((e,t)=>{E().createPdf(me(!1)).getBase64(t=>{e(t)})}),a="TestResults.pdf"):(n=await(r=await(0,T.JF)(l.current,"mail",t),new Promise((e,t)=>{const s=new FileReader;s.onloadend=()=>{const t=s.result.split(",")[1];e(t)},s.onerror=t,s.readAsDataURL(r)})),a="TestResults.xlsx");200===(await(0,v.A)({method:"post",url:L.A.testRun.getAttachmentByEmail,data:JSON.stringify({to:s.email,subject:"Your Recently Generated Report",text:"Please find your Document attached.",userName:`${s.firstName} ${s.lastName}`,base64:n,fileName:a,doc:e}),headers:{Authorization:`Bearer ${(0,P.qt)("accessToken")}`,"Content-Type":"application/json"}})).status?Q("Mail sent successfully",{variant:"success"}):Q("Mail sending failed",{variant:"error"})}catch(i){console.log("error",i)}finally{Y(null),K(!1)}var r};const he=e=>{switch(e){case"PASSED":return"green";case"FAILED":return"red";case"SKIPPED":return"orange";default:return"black"}},pe=async e=>{l.current=[];const t=[],a=s.current.filter(t=>e.includes(t.releaseName));K(!0);const n=await(async e=>{let t=[];const s=[];try{if(e.forEach(e=>{Array.isArray(e.latestJobIds)?t=[...t,...e.latestJobIds]:t.push(e.latestJobIds)}),0!==t.length){const e=await(0,v.A)({method:"get",url:`${L.A.releases.getMultiTestRunStatus(t)}`,headers:{Authorization:`Bearer ${(0,P.qt)("accessToken")}`}}),a=null===e||void 0===e?void 0:e.data;return de(a).forEach(e=>{let t={};const a=[],{testNodes:n}=e;n.forEach(e=>{const{testCaseSteps:s,testStepStatuses:n}=e,r=[],i=[],l=[];let o=0;s.forEach(e=>{const t=F(e,"testStepDescription");if(void 0!==t){var s;r.push(t),o+=1,l.push(o);const a=n.find(t=>t._id===e._id);i.push(null!==(s=null===a||void 0===a?void 0:a.status)&&void 0!==s?s:"UNTESTED")}}),t={testCaseId:e.testCaseID,testCaseTitle:e.testCaseTitle,testCaseDescription:e.testCaseDescription,testCaseStatus:e.status,testCaseExecutionDuration:e.executionDuration,testCaseSteps:r,testCaseStepStatus:i,testCaseStepNumbers:l},a.push(t)}),s.push({releaseName:e.releaseName,testCases:a})}),s}}catch(a){return console.log(a),a}})(a);K(!1),a.forEach(e=>{const s={releaseName:e.releaseName,executionStart:o()(e.executionStart).format("MMMM Do YYYY, h:mm:ss A")||"",executionEnd:o()(e.executionEnd).format("MMMM Do YYYY, h:mm:ss A")||"",executionDuration:e.executionDuration,total:e.total,passed:e.passed,failed:e.failed,skipped:e.skipped,untested:e.untested,blocked:(null===e||void 0===e?void 0:e.blocked)||0};l.current.push(s),t.push(s)}),n&&(t.forEach(e=>{const t=n.find(t=>t.releaseName===e.releaseName);t&&(e.testCases=t.testCases)}),l.current=[],l.current.push(...t),me(!0))},xe=(e,t)=>{const s=[],a=[];return t.testCases&&a.push("Test Case ID","Title","Description","Status","Execution Duration"),t.testCaseSteps&&a.push("Step No","Test Step Description"),t.testCaseStepStatus&&a.push("Test Step Status"),s.push(a),e.forEach(e=>{const a=e.testCaseStepNumbers||[],n=e.testCaseSteps||[],r=e.testCaseStepStatus||[],i=Math.max(a.length,n.length,r.length,1),l=i;for(let o=0;o<i;o+=1){const i=0===o,c=[];t.testCases&&(i?c.push({text:e.testCaseId||"",rowSpan:l},{text:e.testCaseTitle||"",rowSpan:l},{text:e.testCaseDescription||"",rowSpan:l},{text:e.testCaseStatus||"",rowSpan:l,color:he(e.testCaseStatus),bold:!0},{text:e.testCaseExecutionDuration||"",rowSpan:l}):c.push("","","","","")),t.testCaseSteps&&c.push(a[o]||"",n[o]||""),t.testCaseStepStatus&&c.push({text:r[o]||"",color:he(r[o]),italics:!0}),s.push(c)}}),s},me=e=>{const t=[];l.current.forEach((e,s)=>{if(0!==s&&t.push({text:"",pageBreak:"before"}),t.push({text:"Release Summary",style:"header"},{table:{widths:["*","*"],body:[["Release Name",e.releaseName],["Execution Start",e.executionStart],["Execution End",e.executionEnd],["Execution Duration",e.executionDuration],["Total",e.total],["Passed",e.passed],["Failed",e.failed],["Skipped",e.skipped],["Untested",e.untested],["Blocked",e.blocked]]},layout:"lightHorizontalLines",margin:[0,0,0,20]}),ie.testCases){const s=(ie.testCases?5:0)+(ie.testCaseSteps?2:0)+(ie.testCaseStepStatus?1:0);t.push({text:"Test Cases Summary",style:"subheader"},{table:{headerRows:1,widths:Array(s).fill("auto"),body:xe(e.testCases,ie)},layout:"lightHorizontalLines"})}});const s={pageOrientation:"landscape",content:t,styles:{header:{fontSize:20,bold:!0,marginBottom:10},subheader:{fontSize:14,bold:!0,margin:[0,10,0,5]}}},a=E().createPdf(s);return e&&a.getBlob(e=>{const t=URL.createObjectURL(e);te(t)}),s};return(0,$.jsx)(k.YW,{title:"Test Ensure",children:(0,$.jsxs)(c.A,{maxWidth:!ae&&"xl",children:[(0,$.jsx)(_.A,{heading:"Report",links:[{name:"Releases",href:(e=>{let t=e;return se&&(t=`${e}?${se}`),t})(z.nB.release.allReleases)},{name:"Report"}],info:"Generate a PDF Report that will be sent through email, which conatins Release and Test Run Details."}),(0,$.jsx)(n.QI,{value:re,children:(0,$.jsxs)(n.lV,{noValidate:!0,autoComplete:"off",onSubmit:le,children:[(0,$.jsx)(d.Ay,{container:!0,spacing:3,children:(0,$.jsx)(d.Ay,{item:!0,xs:12,md:12,children:(0,$.jsx)(u.A,{sx:{p:3},children:(0,$.jsx)(h.A,{spacing:3,children:(0,$.jsxs)(h.A,{spacing:2,sx:{width:1},children:[(0,$.jsx)(p.A,{variant:"overline",sx:{color:"text.secondary"},children:"Select Releases"}),(0,$.jsx)(h.A,{children:(0,$.jsx)(x.A,{name:"releases",id:"releases",multiple:!0,options:Array.isArray(w)?w:[],loading:J,getOptionLabel:e=>e,isOptionEqualToValue:(e,t)=>e===t,value:ie.releaseList,onChange:(e,t)=>{oe("releaseList",t),pe(t)},renderTags:(e,t)=>e.map((e,s)=>(0,$.jsx)(m.A,{label:e,...t({index:s})},e)),renderInput:e=>(0,$.jsx)(S.A,{...e,label:"Select Releases"}),noOptionsText:J?"":Z})}),ie.releaseList&&ie.releaseList.length>0&&(0,$.jsxs)($.Fragment,{children:[(0,$.jsx)(p.A,{variant:"overline",sx:{color:"text.secondary"},children:"Select the below to include in the report"}),(0,$.jsxs)(h.A,{direction:"row",spacing:3,alignItems:"flex-start",children:[(0,$.jsx)(h.A,{spacing:1,alignItems:"flex-start",children:(0,$.jsx)(g.A,{control:(0,$.jsx)(A.A,{checked:!0,disabled:!0,sx:{"& .MuiSwitch-thumb":{color:"primary.main"},"& .MuiSwitch-track":{backgroundColor:"primary.main",opacity:1},"&.Mui-checked .MuiSwitch-thumb":{color:"primary.main"},"&.Mui-checked .MuiSwitch-track":{backgroundColor:"primary.main",opacity:1},"&.Mui-disabled.Mui-checked .MuiSwitch-track":{backgroundColor:"primary.main",opacity:1}}}),label:(0,$.jsx)(p.A,{variant:"subtitle2",sx:{mb:.5},children:"Test Run"}),sx:{mx:0}})}),(0,$.jsxs)(h.A,{spacing:2,direction:"row",children:[(0,$.jsx)(g.A,{control:(0,$.jsx)(A.A,{checked:ie.testCases,onChange:e=>{const t=e.target.checked;oe("testCases",t),t||(oe("testCaseSteps",!1),oe("testCaseStepStatus",!1))}}),label:(0,$.jsx)(p.A,{variant:"subtitle2",sx:{mb:.5},children:"Test Cases"}),sx:{mx:0}}),(0,$.jsx)(g.A,{control:(0,$.jsx)(A.A,{disabled:!ie.testCases,checked:ie.testCaseSteps,onChange:e=>{const t=e.target.checked;oe("testCaseSteps",t),t||oe("testCaseStepStatus",!1)}}),label:(0,$.jsx)(p.A,{variant:"subtitle2",sx:{mb:.5},children:"Test Case Steps"}),sx:{mx:0}}),(0,$.jsx)(g.A,{control:(0,$.jsx)(A.A,{disabled:!ie.testCaseSteps,checked:ie.testCaseStepStatus,onChange:e=>{oe("testCaseStepStatus",e.target.checked)}}),label:(0,$.jsx)(p.A,{variant:"subtitle2",sx:{mb:.5},children:"Test Case Step Status"}),sx:{mx:0}})]})]}),(0,$.jsx)(p.A,{variant:"overline",sx:{color:"text.secondary"},children:"PDF Preview"}),(0,$.jsxs)(h.A,{children:[(0,$.jsx)(N.A,{loading:H}),ee&&(0,$.jsx)("iframe",{title:"PDF Preview",src:`${ee}#zoom=100`,width:"100%",height:"600px",style:{border:"1px solid #ccc",marginTop:"20px"}})]}),(0,$.jsxs)(h.A,{direction:"row",spacing:2,children:[(0,$.jsx)(f.A,{variant:"contained",size:"small",onClick:()=>ue("pdf"),disabled:!!O,children:"pdf"===O?"Sending...":"Email PDF Report"}),(0,$.jsx)(f.A,{variant:"contained",size:"small",onClick:()=>ue("excel"),disabled:!!O,children:"excel"===O?"Sending...":"Email Excel Report"})]})]})]})})})})}),(0,$.jsxs)(C.A,{open:V,onClose:()=>q(!1),children:[(0,$.jsx)(b.A,{style:{marginBottom:"16px"},children:"No Releases against Project"}),(0,$.jsxs)(j.A,{children:[(0,$.jsx)("span",{role:"img","aria-label":"warning",style:{color:"red",fontWeight:"bold"},children:"\u26a0\ufe0f"})," ",(0,$.jsx)("span",{style:{fontWeight:"bold",color:"red"},children:"Please navigate back to Releases screen."})]}),(0,$.jsx)(y.A,{children:(0,$.jsx)(f.A,{onClick:()=>{q(!1),setTimeout(()=>{ne(z.nB.release.allReleases)},300)},color:"secondary",children:"Ok"})})]})]})})]})})}}}]);
//# sourceMappingURL=7745.82be3a81.chunk.js.map