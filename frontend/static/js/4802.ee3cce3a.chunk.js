"use strict";(self.webpackChunk_minimal_minimal_kit_react=self.webpackChunk_minimal_minimal_kit_react||[]).push([[4802],{4802:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var o=a(65043),l=a(73216),n=a(85865),s=a(96446),r=a(33211),i=a(88930),d=a(95683),u=a(32393),c=a(49788),v=a(70579);const h=e=>{let{streamUrl:t}=e;const a=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=a.current;if(c.Ay.isSupported()){const a=new c.Ay({xhrSetup:e=>{e.setRequestHeader("Authorization",`Bearer ${localStorage.getItem("accessToken")}`)}});console.log("streamUrl",t),a.loadSource(t),a.attachMedia(e),a.on(c.Ay.Events.ERROR,(e,t)=>{console.error("HLS.js error:",t)})}else e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=t)},[]),(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"p-4",children:(0,v.jsx)("video",{ref:a,controls:!0,autoPlay:!0,muted:!0,onEnded:()=>console.log("Video ended"),style:{position:"absolute",width:"90vw",height:"90vh",objectFit:"cover",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})})})};var m=a(77137),g=a(5963);function p(){var e;const t=(0,o.useRef)(null),{testRunId:a}=(0,l.g)(),[c,p]=(0,o.useState)(!0),[f,j]=(0,o.useState)(),[y,x]=(0,o.useState)(null),[R,S]=(0,o.useState)(null),[w,A]=(0,o.useState)(null),[b,k]=(0,o.useState)(null),_=async()=>{let e=null;try{var t,o,l,n,s;const m=await(0,d.uV)(),p=`${i.A.testRun.getJob(m._id,a)}`,f=await(0,r.A)({method:"get",url:p,headers:{Authorization:`Bearer ${(0,g.qt)("accessToken")}`}});var u,c,v,h;if(null!==f&&void 0!==f&&null!==(t=f.data)&&void 0!==t&&null!==(o=t.data)&&void 0!==o&&o.jenkinsJobName)S(null===f||void 0===f||null===(u=f.data)||void 0===u||null===(c=u.data)||void 0===c?void 0:c.jenkinsJobName),e=null===f||void 0===f||null===(v=f.data)||void 0===v?void 0:v.data,A(null===f||void 0===f||null===(h=f.data)||void 0===h?void 0:h.data);"View"===(null===f||void 0===f||null===(l=f.data)||void 0===l||null===(n=l.data)||void 0===n||null===(s=n.linuxScreenRecord)||void 0===s?void 0:s.status)?F():E()}catch(m){console.log("error",m)}return e},E=async()=>{if(console.log("jenkinsJobName",R),R){try{const e=`${i.A.testRun.liveStreamVideo(R)}`;console.log("api",e);await(0,r.A)({method:"get",url:e,headers:{Authorization:`Bearer ${(0,g.qt)("accessToken")}`}});k(e),p(!1)}catch(e){console.log("error",e),k(null)}_()}},F=(0,o.useCallback)(async()=>{var e;const o=await(0,d.uV)();null===t||void 0===t||null===(e=t.current)||void 0===e||e.load(),(0,g.ou)(m.Rk.CURRENT_TESTRUN,JSON.stringify({_id:a}));try{const e=`${i.A.testRun.streamVideo(o._id,a)}?bypass=true`,t=await r.A.get(e,{headers:{Range:"bytes=0-"}});console.log("response.status",t.data.status),400===t.data.status?j(t.data.message):x(e)}catch(l){console.error("Error fetching video:",l)}p(!1)},[a]);return(0,o.useEffect)(async()=>{await _()},[F,R,y,null===w||void 0===w||null===(e=w.linuxScreenRecord)||void 0===e?void 0:e.status]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(n.A,{style:{textAlign:"center",fontWeight:"500"},children:f}),c&&(0,v.jsx)(u.A,{}),!y&&b&&(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)("div",{style:{position:"absolute",width:"90vw",height:"90vh",objectFit:"cover",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[(0,v.jsx)("h4",{children:"Live Stream"}),(0,v.jsx)(h,{videoUrl:y,streamUrl:b})]})}),!c&&y&&(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(s.A,{component:"video",src:y,muted:!0,controls:!0,preload:"auto",sx:{position:"absolute",width:"90vw",height:"90vh",objectFit:"cover",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}})})]})}}}]);
//# sourceMappingURL=4802.ee3cce3a.chunk.js.map