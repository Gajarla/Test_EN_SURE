{"version":3,"file":"static/js/4802.ee3cce3a.chunk.js","mappings":"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","sources":["pages/dashboard/LiveStreamPlayer.js","pages/dashboard/TestRunVideo.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport Hls from 'hls.js';\n\nconst LiveStreamPlayer = ({ streamUrl }) => {\n  const videoRef = useRef(null);\n\n  useEffect(() => {\n    const video = videoRef.current;\n\n    if (Hls.isSupported()) {\n      const hls = new Hls({\n        xhrSetup: (xhr) => {\n          // This is the shorthand for function expressions\n          xhr.setRequestHeader('Authorization', `Bearer ${localStorage.getItem('accessToken')}`);\n        }\n      });\n      console.log('streamUrl', streamUrl);\n      hls.loadSource(streamUrl);\n      hls.attachMedia(video);\n      hls.on(Hls.Events.ERROR, (e, data) => {\n        console.error('HLS.js error:', data);\n      });\n    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {\n      video.src = streamUrl;\n    }\n  }, []);\n\n  return (\n    <>\n      <div className=\"p-4\">\n        <video\n          ref={videoRef}\n          controls\n          autoPlay\n          muted\n          onEnded={() => console.log('Video ended')}\n          // style={{ width: '100%', maxWidth: '1280px', borderRadius: '10px' }}\n          style={{\n            position: 'absolute',\n            width: '90vw',\n            height: '90vh',\n            objectFit: 'cover',\n            top: '50%',\n            left: '50%',\n            transform: 'translate(-50%, -50%)'\n          }}\n        />\n      </div>\n    </>\n  );\n};\n\nexport default LiveStreamPlayer;\n","import { useEffect, useState, useRef, useCallback } from 'react';\nimport { useParams } from 'react-router-dom';\n// material\n// redux\n// import axios from 'axios';\n\nimport { Box, Typography } from '@mui/material';\nimport axios from '../../utils/axiosInstance';\nimport API from '../../services';\nimport { getIDBCurrentUser } from '../../main';\nimport LoadingScreen from '../../components/LoadingScreen';\nimport LiveStreamPlayer from './LiveStreamPlayer';\nimport { INDEXEDDB_KEYS } from '../../Constants';\nimport { getSessionObj, setSessionObj } from '../../utils/jwt';\n\n// ----------------------------------------------------------------------\n\nexport default function TestRunVideo() {\n  const videoRef = useRef(null);\n  const { testRunId } = useParams();\n  const [isLoading, setIsloading] = useState(true);\n  const [msg, setMsg] = useState();\n  const [videoUrl, setVideoUrl] = useState(null);\n  const [jenkinsJobName, setJenkinsJobName] = useState(null);\n  const [job, setJob] = useState(null);\n  const [streamUrl, setStreamUrl] = useState(null);\n  // const streamUrl = 'http://localhost:5000/api/releases/stream/Test_Live_video_SalesOrder_1/index.m3u8?bypass=true';\n\n  const getJobInfo = async () => {\n    let job = null;\n    try {\n      const currentUser = await getIDBCurrentUser();\n      const api = `${API.testRun.getJob(currentUser._id, testRunId)}`;\n      const response = await axios({\n        method: 'get',\n        url: api,\n        headers: {\n          Authorization: `Bearer ${getSessionObj('accessToken')}`\n        }\n      });\n      if (response?.data?.data?.jenkinsJobName) {\n        setJenkinsJobName(response?.data?.data?.jenkinsJobName);\n        job = response?.data?.data;\n        setJob(response?.data?.data);\n      }\n      if (response?.data?.data?.linuxScreenRecord?.status === 'View') openLinuxRecord();\n      else getLiveStreamUrl();\n\n      // if (response?.data?.data?.linuxScreenRecord?.status === 'Live') getLiveStreamUrl();\n    } catch (error) {\n      console.log('error', error);\n    }\n    return job;\n  };\n\n  const getLiveStreamUrl = async () => {\n    console.log('jenkinsJobName', jenkinsJobName);\n    if (jenkinsJobName) {\n      try {\n        const api = `${API.testRun.liveStreamVideo(jenkinsJobName)}`;\n        console.log('api', api);\n        const response = await axios({\n          method: 'get',\n          url: api,\n          headers: {\n            Authorization: `Bearer ${getSessionObj('accessToken')}`\n          }\n        });\n        setStreamUrl(api);\n        setIsloading(false);\n      } catch (error) {\n        console.log('error', error);\n        setStreamUrl(null);\n      }\n      getJobInfo();\n    }\n  };\n\n  const openLinuxRecord = useCallback(async () => {\n    const currentUser = await getIDBCurrentUser();\n    videoRef?.current?.load();\n\n    setSessionObj(INDEXEDDB_KEYS.CURRENT_TESTRUN, JSON.stringify({ _id: testRunId }));\n\n    // if (job?.linuxScreenRecord?.status === 'View') {\n    try {\n      const api = `${API.testRun.streamVideo(currentUser._id, testRunId)}?bypass=true`;\n      const response = await axios.get(api, {\n        headers: {\n          Range: 'bytes=0-' // Requesting the entire file from the start\n        }\n      });\n      console.log('response.status', response.data.status);\n      if (response.data.status === 400) {\n        setMsg(response.data.message);\n      } else {\n        setVideoUrl(api); // Adjust based on API response structure\n      }\n    } catch (err) {\n      // setError('Failed to load video. Please try again.');\n      console.error('Error fetching video:', err);\n    }\n    setIsloading(false);\n    // }\n  }, [testRunId]);\n\n  useEffect(async () => {\n    await getJobInfo();\n  }, [openLinuxRecord, jenkinsJobName, videoUrl, job?.linuxScreenRecord?.status]);\n\n  return (\n    <>\n      <Typography style={{ textAlign: 'center', fontWeight: '500' }}>{msg}</Typography>\n      {isLoading && <LoadingScreen />}\n      {!videoUrl && streamUrl && (\n        <>\n          <div\n            style={{\n              position: 'absolute',\n              width: '90vw',\n              height: '90vh',\n              objectFit: 'cover',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)'\n            }}\n          >\n            <h4>Live Stream</h4>\n            <LiveStreamPlayer videoUrl={videoUrl} streamUrl={streamUrl} />\n          </div>\n        </>\n      )}\n\n      {!isLoading && videoUrl && (\n        <>\n          <Box\n            component=\"video\"\n            src={videoUrl}\n            muted\n            controls\n            preload=\"auto\"\n            sx={{\n              position: 'absolute',\n              width: '90vw',\n              height: '90vh',\n              objectFit: 'cover',\n              top: '50%',\n              left: '50%',\n              transform: 'translate(-50%, -50%)'\n            }}\n          />\n        </>\n      )}\n    </>\n  );\n}\n"],"names":["_ref","streamUrl","videoRef","useRef","useEffect","video","current","Hls","hls","xhrSetup","xhr","setRequestHeader","localStorage","getItem","console","log","loadSource","attachMedia","on","ERROR","e","data","error","canPlayType","src","_jsx","_Fragment","children","className","ref","controls","autoPlay","muted","onEnded","style","position","width","height","objectFit","top","left","transform","TestRunVideo","_job$linuxScreenRecor","testRunId","useParams","isLoading","setIsloading","useState","msg","setMsg","videoUrl","setVideoUrl","jenkinsJobName","setJenkinsJobName","job","setJob","setStreamUrl","getJobInfo","async","_response$data","_response$data$data","_response$data5","_response$data5$data","_response$data5$data$","currentUser","getIDBCurrentUser","api","API","testRun","getJob","_id","response","axios","method","url","headers","Authorization","getSessionObj","_response$data2","_response$data2$data","_response$data3","_response$data4","linuxScreenRecord","status","openLinuxRecord","getLiveStreamUrl","liveStreamVideo","useCallback","_videoRef$current","load","setSessionObj","INDEXEDDB_KEYS","CURRENT_TESTRUN","JSON","stringify","streamVideo","get","Range","message","err","_jsxs","Typography","textAlign","fontWeight","LoadingScreen","LiveStreamPlayer","Box","component","preload","sx"],"sourceRoot":""}